namespace = ab_byzantium_disaster
normal_or_historical_nations = yes

## FALL OF THE ANGELIDS -----
#Fall Of The Angelid Dynasty Start
country_event = {
	id = ab_byzantium_disaster.0
	title = ab_byzantium_disaster.0.t
	desc = ab_byzantium_disaster.0.d
	picture = BYZANTINE_EAGLE_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			add_stability = -2
			add_manpower = -8
		}
	}
	
	option = {
		name = ab_byzantium_disaster.0.a
		tooltip = {
			add_stability = -2
			add_manpower = -8
		}
		add_country_modifier = {
			name = byz_revolt_mil
			duration = -1
		}
	}
}

#Fall Of The Angelid Dynasty End
country_event = {
	id = ab_byzantium_disaster.1
	title = ab_byzantium_disaster.1.t
	desc = ab_byzantium_disaster.1.d
	picture = AB_JUSTINIAN_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_country_flag = byz_epirus_ruler
			}
			hidden_effect = {
				define_ruler = {
					name = "Manuel III"
					adm = 4
					dip = 3
					mil = 5
					dynasty = "Palaiologos"
					claim = 100
				}
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.1.a
		if = {
			limit = {
				NOT = {
					mission_completed = byzantium_court
				}
			}
			complete_mission = byzantium_court
		}
		if = {
			limit = {
				NOT = {
					mission_completed = byzantium_economy
				}
			}
			complete_mission = byzantium_economy
		}
		if = {
			limit = {
				NOT = {
					mission_completed = byzantium_imperial_army
				}
			}
			complete_mission = byzantium_imperial_army
		}
		if = {
			limit = {
				NOT = {
					mission_completed = byzantium_traitors
				}
			}
			complete_mission = byzantium_traitors
		}
		if = {
			limit = {
				NOT = {
					mission_completed = byzantium_crisis
				}
			}
			complete_mission = byzantium_crisis
		}
		if = {
			limit = {
				has_country_flag = byz_epirus_ruler
			}
			if = {
				limit = {
					exists = EPI
				}
				inherit = EPI
			}
			
			if = {
				limit = {
					has_heir = yes
				}
				hidden_effect = {
					kill_heir = {}
				}
			}
		}
		if = {
			limit = {
				has_country_flag = byz_epirus_war
			}
			if = {
				limit = {
					has_country_flag = byz_epirus_venice
					151 = {
						country_or_non_sovereign_subject_holds = ROOT	
					}
					149 = {
						country_or_non_sovereign_subject_holds = ROOT	
					}
					4779 = {
						country_or_non_sovereign_subject_holds = ROOT	
					}
					4705 = {
						country_or_non_sovereign_subject_holds = ROOT	
					}
					147 = {
						country_or_non_sovereign_subject_holds = ROOT	
					}
					144 = {
						country_or_non_sovereign_subject_holds = ROOT	
					}
					4699 = {
						country_or_non_sovereign_subject_holds = ROOT	
					}
					morea_area = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT	
					}
					ionian_islands_area = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT	
					}
				}
				custom_tooltip = BYZ_RESTORER_PP
				hidden_effect = {
					add_power_projection = {
						type = BYZ_perma_pp
						amount = 15
					}
				}
				add_country_modifier = {
					name = byz_restorer_angelid
					duration = 18250
				}
				add_ruler_personality = augustus_personality
			}
		}
		remove_country_modifier = byz_revolt_mil
		set_country_flag = byz_finished_angelid_crisis
		add_government_reform = imperial_autocracy
	}
}

#Epirus Rebellion
country_event = {
	id = ab_byzantium_disaster.2
	title = ab_byzantium_disaster.2.t
	desc = ab_byzantium_disaster.2.d
	picture = AB_CHARGE_eventPicture

	fire_only_once = yes
	
	trigger = {
		tag = BYZ
		has_disaster = byzantium_fall_angelid
		EPI = {
			is_subject_of = ROOT
			has_ruler = "Manuel III"
			dynasty = "Palaiologos"
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}

	option = {
		name = ab_byzantium_disaster.2.a
		ai_chance = { factor = 80 }
		hidden_effect = {
			release_all_subjects = yes
			318 = {
				add_claim = EPI
			}
		}
		EPI = {
			convert_ruler_to_general = 75
			declare_war_with_cb = {
			    who = BYZ
			    casus_belli = cb_conquest
				war_goal_province = 151
		    }
			capital_scope = {
				build_to_forcelimit = {
					infantry = 0.8
					cavalry = 0.2
				}
			}
		}
		custom_tooltip = AB_EMPTY
		custom_tooltip = BYZ_EPIRUS_FIGHT
		set_country_flag = byz_epirus_war
	}
	
	option = {
		name = ab_byzantium_disaster.2.b
		ai_chance = { factor = 20 }
		custom_tooltip = BYZ_EPIRUS_SURRENDER
		set_country_flag = byz_epirus_ruler
	}
}

#Manuel Palaiologos Crowned - Hidden event
country_event = {
	id = ab_byzantium_disaster.3
	title = ab_byzantium_disaster.3.t
	desc = ab_byzantium_disaster.3.d
	picture = COUNTRY_COLLAPSE_eventPicture

	fire_only_once = yes

	hidden = yes
	
	trigger = {
		tag = BYZ
		has_disaster = byzantium_fall_angelid
		OR = {
			AND = {
				is_in_war = {
					attacker_leader = EPI
					defender_leader = ROOT
				}
				capital_scope = {
					controlled_by = EPI
				}
			}
			has_country_flag = byz_epirus_ruler
		}
	}
	
	mean_time_to_happen = {
		days = 21
	}
	
	option = {
		name = ab_byzantium_disaster.3.a
		set_country_flag = had_fall_angelid
		add_stability = 4
		if = {
			limit = {
				has_country_flag = byz_epirus_war
			}
			set_country_flag = byz_epirus_ruler
			clr_country_flag = byz_epirus_war
		}
		if = {
			limit = {
				war_with = VEN
			}
			add_prestige = -10
			white_peace = VEN
			inherit = EPI
			146 = {
				cede_province = VEN
				add_core = VEN
			}
			5152 = {
				cede_province = VEN
				add_core = VEN
			}
		}
	}
}

#Noble Uprising
country_event = {
	id = ab_byzantium_disaster.4
	title = ab_byzantium_disaster.4.t
	desc = ab_byzantium_disaster.4.d
	picture = BAD_WITH_MONARCH_eventPicture

	fire_only_once = yes

	trigger = {
		tag = BYZ
		has_disaster = byzantium_fall_angelid
		has_country_flag = byz_epirus_war
	}
	
	mean_time_to_happen = {
		months = 2
	}
	
	option = {
		name = ab_byzantium_disaster.4.a
		set_country_flag = byz_epirus_revolt
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -20
		}
		random_owned_province = {
			noble_rebels = 1
		}
		random_owned_province = {
			noble_rebels = 1
		}
	}
}

#Venice demands Athens and Thebes 1 - Venice threatens war
country_event = {
	id = ab_byzantium_disaster.5
	title = ab_byzantium_disaster.5.t
	desc = ab_byzantium_disaster.5.d
	picture = BATTLE_eventPicture
	
	fire_only_once = yes
	
	mean_time_to_happen = {
		months = 2
	}

	trigger = {
		tag = VEN
		BYZ = {
			has_disaster = byzantium_fall_angelid
			has_country_flag = byz_epirus_revolt
			owns = 146
			owns = 5152
			is_at_war = yes
		}
	}
	
	option = {
		name = ab_byzantium_disaster.5.a
		ai_chance = { factor = 90 }
		BYZ = {
			country_event = { id = ab_byzantium_disaster.6 }
		}
	}

	option = {
		name = ab_byzantium_disaster.5.b
		ai_chance = { factor = 10 }
		add_prestige = -10
	}
}

#Venice demands Athens and Thebes 2 - Byzantium receives Venice threat
country_event = {
	id = ab_byzantium_disaster.6
	title = ab_byzantium_disaster.6.t
	desc = ab_byzantium_disaster.6.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes
		
	option = {
		name = ab_byzantium_disaster.6.a
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = {
					VEN = {
						army_size = ROOT
					}
				}
			}
		}
		add_prestige = -10
		add_truce_with = VEN
		146 = {
			cede_province = VEN
			add_core = VEN
			remove_core = BYZ
		}
		5152 = {
			cede_province = VEN
			add_core = VEN
			remove_core = BYZ
		}
		VEN = {
			country_event = { id = ab_byzantium_disaster.7 }
		}
	}

	option = {
		name = ab_byzantium_disaster.6.b
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				VEN = {
					army_size = ROOT
				}
			}
		}
		add_legitimacy = 10
		VEN = {
			country_event = { id = ab_byzantium_disaster.8 }
		}
		custom_tooltip = BYZ_VEN_WAR
	}
}

#Venice demands Athens and Thebes 3 - Byzantium accepts
country_event = {
	id = ab_byzantium_disaster.7
	title = ab_byzantium_disaster.7.t
	desc = ab_byzantium_disaster.7.d
	picture = BATTLE_eventPicture

	is_triggered_only = yes
		
	option = {
		name = ab_byzantium_disaster.7.a
		add_prestige = 10
		custom_tooltip = BYZ_VEN_SURRENDER		
	}
}

#Venice demands Athens and Thebes 4 - Byzantium refuses
country_event = {
	id = ab_byzantium_disaster.8
	title = ab_byzantium_disaster.8.t
	desc = ab_byzantium_disaster.8.d
	picture = BATTLE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_byzantium_disaster.8.a
		hidden_effect = {
			146 = {
				add_claim = VEN
			}
			5152 = {
				add_claim = VEN
			}
		}
		declare_war_with_cb = {
			who = BYZ
			casus_belli = cb_conquest
			war_goal_province = 146
		}
		BYZ = {
			set_country_flag = byz_epirus_venice
		}
	}	
}

#Venice demands Athens and Thebes 5 - Nicaea joins
country_event = {
	id = ab_byzantium_disaster.9
	title = ab_byzantium_disaster.9.t
	desc = ab_byzantium_disaster.9.d
	picture = BYZ_CIVIL_WAR_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = NCI
		BYZ = {
			has_disaster = byzantium_fall_angelid
			has_country_flag = byz_epirus_venice
			is_at_war = yes
		}
		is_at_war = no
	}
	
	mean_time_to_happen = {
		months = 3
	}
	
	option = {
		name = ab_byzantium_disaster.9.a
		ai_chance = { factor = 70 }
		join_all_offensive_wars_of = VEN
		BYZ = {
			country_event = { id = ab_byzantium_disaster.10 }
		}
	}	

	option = {
		name = ab_byzantium_disaster.9.b
		ai_chance = { factor = 30 }
		add_prestige = -10
	}	
}

#Venice demands Athens and Thebes 6 - Nicaea joins - Inform Byz
country_event = {
	id = ab_byzantium_disaster.10
	title = ab_byzantium_disaster.10.t
	desc = ab_byzantium_disaster.10.d
	picture = BYZ_CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_byzantium_disaster.10.a
	}
}

#Venice demands Athens and Thebes 7 - Bulgaria joins
country_event = {
	id = ab_byzantium_disaster.11
	title = ab_byzantium_disaster.11.t
	desc = ab_byzantium_disaster.11.d
	picture = BYZ_CIVIL_WAR_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = BUL
		BYZ = {
			has_disaster = byzantium_fall_angelid
			has_country_flag = byz_epirus_venice
			is_at_war = yes
		}
		is_at_war = no
	}
	
	mean_time_to_happen = {
		months = 6
	}
	
	option = {
		name = ab_byzantium_disaster.11.a
		ai_chance = {
			factor = 70
			modifier = {
				factor = 0
				has_country_flag = bul_byzantium_refused
			}
		}
		join_all_offensive_wars_of = VEN
		BYZ = {
			country_event = { id = ab_byzantium_disaster.12 }
		}
	}	

	option = {
		name = ab_byzantium_disaster.11.b
		ai_chance = { factor = 30 }
		add_prestige = -10
	}	
}

#Venice demands Athens and Thebes 8 - Bulgaria joins - Inform Byz
country_event = {
	id = ab_byzantium_disaster.12
	title = ab_byzantium_disaster.12.t
	desc = ab_byzantium_disaster.12.d
	picture = BYZ_CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_byzantium_disaster.12.a
	}
}

#Ioannes Assassination
country_event = {
	id = ab_byzantium_disaster.13
	title = ab_byzantium_disaster.13.t
	desc = ab_byzantium_disaster.13.d
	picture = ASSASSINATION_eventPicture
	
	fire_only_once = yes
	
	mean_time_to_happen = {
		months = 5
	}

	trigger = {
		tag = BYZ
		has_disaster = byzantium_fall_angelid
		has_country_flag = byz_epirus_venice
	}
	
	option = {
		name = ab_byzantium_disaster.13.a
		change_monarch_points_or_power = {
			points = 1
			power = adm
		}
		change_monarch_points_or_power = {
			points = 1
			power = dip
		}
		change_monarch_points_or_power = {
			points = 1
			power = mil
		}
	}

	option = {
		name = ab_byzantium_disaster.13.b
		hidden_effect = {
			define_ruler = {
				adm = 4
				dip = 4
				mil = 4
				dynasty = "Laskaris"
				claim = 50
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.13.c
		hidden_effect = {
			define_ruler = {
				adm = 4
				dip = 4
				mil = 4
				dynasty = "Doukas"
				claim = 50
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.13.de
		hidden_effect = {
			define_ruler = {
				adm = 4
				dip = 4
				mil = 4
				dynasty = "Komnenos"
				claim = 50
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.13.e
		hidden_effect = {
			define_ruler = {
				adm = 4
				dip = 4
				mil = 4
				claim = 30
			}
		}
	}
}

#Defeat Epirus - Hidden 
country_event = {
	id = ab_byzantium_disaster.14
	title = ab_byzantium_disaster.14.t
	desc = ab_byzantium_disaster.14.d
	picture = COUNTRY_COLLAPSE_eventPicture

	fire_only_once = yes

	hidden = yes
	
	trigger = {
		tag = BYZ
		has_disaster = byzantium_fall_angelid
		has_country_flag = byz_epirus_venice
		142 = {
			country_or_non_sovereign_subject_holds = ROOT	
		}
		144 = {
			country_or_non_sovereign_subject_holds = ROOT	
		}
		4698 = {
			country_or_non_sovereign_subject_holds = ROOT	
		}
		4699 = {
			country_or_non_sovereign_subject_holds = ROOT	
		}
	}
	
	option = {
		name = ab_byzantium_disaster.14.a
		set_country_flag = had_fall_angelid
		add_stability = 4
	}
}

## CRISIS OF THE SIXTEENTH CENTURY -----
#Crisis of the Sixteenth Century Start
country_event = {
	id = ab_byzantium_disaster.15
	title = ab_byzantium_disaster.15.t
	desc = ab_byzantium_disaster.15.d
	picture = SIERRA_DE_LA_PLATA_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			add_stability = -3
		}
	}
	
	option = {
		name = ab_byzantium_disaster.15.a
		tooltip = {
			add_stability = -3
		}
		custom_tooltip = BYZ_ASHES_THERA
		tooltip = {
			add_devastation = 50
			add_province_modifier = {
				name = byz_ashes_thera
				duration = 3650
			}
		}
		hidden_effect = {
			every_province = {
				limit = {
					OR = {
						area = aegean_archipelago_area
						area = aydin_area
						area = morea_area
						area = northern_greece_area
						area = macedonia_area
						area = thrace_area
						area = hudavendigar_area
						area = cyrenaica_area
					}
				}
				add_devastation = 50
				add_province_modifier = {
					name = byz_ashes_thera
					duration = 3650
				}
			}
		}
	}
}

#Crisis of the Sixteenth Century End
country_event = {
	id = ab_byzantium_disaster.16
	title = ab_byzantium_disaster.16.t
	desc = ab_byzantium_disaster.16.d
	picture = AB_JUSTINIAN_eventPicture
	
	is_triggered_only = yes

	option = {
		name = ab_byzantium_disaster.16.a
		add_stability = 1
		set_country_flag = had_16th_crisis
	}
}

#Eruption Recovery
country_event = {
	id = ab_byzantium_disaster.17
	title = ab_byzantium_disaster.17.t
	desc = ab_byzantium_disaster.17.d
	picture = FAMINE_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
	}

	mean_time_to_happen = {
		days = 21
	}
	
	option = {
		name = ab_byzantium_disaster.17.a
		ai_chance = { factor = 50 }
		add_years_of_income = -2.00
		custom_tooltip = BYZ_THERA_PROVINCES
		tooltip = {
			add_province_modifier = {
				name = byz_thera_funding_max
				duration = 3650
			}
		}
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = aegean_archipelago_area
						area = aydin_area
						area = morea_area
						area = northern_greece_area
						area = macedonia_area
						area = thrace_area
						area = hudavendigar_area
						area = cyrenaica_area
					}
				}
				add_province_modifier = {
					name = byz_thera_funding_max
					duration = 3650
				}
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.17.b
		ai_chance = { factor = 30 }
		add_years_of_income = -1.00
		custom_tooltip = BYZ_THERA_PROVINCES
		tooltip = {
			add_province_modifier = {
				name = byz_thera_funding_min
				duration = 3650
			}
		}
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = aegean_archipelago_area
						area = aydin_area
						area = morea_area
						area = northern_greece_area
						area = macedonia_area
						area = thrace_area
						area = hudavendigar_area
						area = cyrenaica_area
					}
				}
				add_province_modifier = {
					name = byz_thera_funding_min
					duration = 3650
				}
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.17.c
		ai_chance = { factor = 20 }
		add_prestige = -10
	}
}

#Language of the Romans
country_event = {
	id = ab_byzantium_disaster.18
	title = ab_byzantium_disaster.18.t
	desc = ab_byzantium_disaster.18.d
	picture = COURT_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
	}

	mean_time_to_happen = {
		months = 3
	}

	option = {
		name = ab_byzantium_disaster.18.a
		ai_chance = { factor = 10 }
		set_country_flag = byz_court_latin
		custom_tooltip = BYZ_LANGUAGE_LATIN
	}

	option = {
		name = ab_byzantium_disaster.18.b
		ai_chance = { factor = 80 }
		set_country_flag = byz_court_mixed
		custom_tooltip = BYZ_LANGUAGE_MIXED
	}

	option = {
		name = ab_byzantium_disaster.18.c
		ai_chance = { factor = 10 }
		set_country_flag = byz_court_greek
		custom_tooltip = BYZ_LANGUAGE_GREEK
	}
}

#Restoration of the Republic
country_event = {
	id = ab_byzantium_disaster.19
	title = ab_byzantium_disaster.19.t
	desc = ab_byzantium_disaster.19.d
	picture = DEBATE_REPUBLICAN_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
	}

	mean_time_to_happen = {
		months = 6
	}

	option = {
		name = ab_byzantium_disaster.19.a
		ai_chance = { factor = 90 }
		add_prestige = 10
		random_owned_province = {
			limit = { region = balkan_region }
			leadered_peasant_rebels = 2
		}
		random_owned_province = {
			limit = { region = balkan_region }
			leadered_peasant_rebels = 2
		}
		random_owned_province = {
			limit = { region = balkan_region }
			leadered_peasant_rebels = 2
		}
		random_owned_province = {
			limit = { region = balkan_region }
			leadered_peasant_rebels = 2
		}
		random_owned_province = {
			limit = { region = balkan_region }
			leadered_peasant_rebels = 2
		}
		149 = {
			spawn_rebels = {
				type = leadered_peasant_rebels
				size = 3
				leader = "Ioannis Kapodistrias"
			}
		}
		country_event = { id = ab_byzantium_disaster.20 }
	}

	option = {
		name = ab_byzantium_disaster.19.b
		ai_chance = { factor = 10 }
		add_stability = -3
		add_prestige = -10
		add_estate_influence_modifier = {
			estate = estate_burghers
			desc = BYZ_SUPREMACY
			influence = 20
			duration = 7300
		}
		change_estate_land_share = {
			estate = estate_burghers
			share = 15
		}
		set_country_flag = byz_restore_republic
		custom_tooltip = BYZ_RESTORE_REPUBLIC
	}
}

#Nobles demand power
country_event = {
	id = ab_byzantium_disaster.20
	title = ab_byzantium_disaster.20.t
	desc = ab_byzantium_disaster.20.d
	picture = NOBLE_ESTATE_DEMANDS_eventPicture
	
	is_triggered_only = yes

	option = {
		name = ab_byzantium_disaster.20.a
		ai_chance = { factor = 20 }
		add_prestige = -10
		add_estate_influence_modifier = {
			estate = estate_nobles
			desc = BYZ_SUPREMACY
			influence = 20
			duration = 7300
		}
		change_estate_land_share = {
			estate = estate_nobles
			share = 15
		}
	}

	option = {
		name = ab_byzantium_disaster.20.b
		ai_chance = { factor = 30 }
		add_prestige = -5
		add_estate_influence_modifier = {
			estate = estate_nobles
			desc = BYZ_SUPREMACY
			influence = 10
			duration = 7300
		}
		change_estate_land_share = {
			estate = estate_nobles
			share = 5
		}
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
	}

	option = {
		name = ab_byzantium_disaster.20.c
		ai_chance = { factor = 50 }
		add_prestige = 10
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
		random_owned_province = {
			limit = { region = anatolia_region }
			noble_rebels = 2
		}
	}
}

#Ayyubids Resurrection
country_event = {
	id = ab_byzantium_disaster.21
	title = ab_byzantium_disaster.21.t
	desc = ab_byzantium_disaster.21.d
	picture = AB_CHARGE_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
	}

	mean_time_to_happen = {
		months = 12
	}

	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = syria_area
						area = aleppo_area
						area = syrian_desert_area
					}
				}
				add_core = RYB
			}
			release = RYB
			RYB = {
				change_primary_culture = al_suryah_arabic
				change_religion = sunni
				change_government = monarchy
				add_government_reform = iqta
				change_technology_group = muslim
				change_unit_type = muslim
				add_army_tradition = 50
				add_prestige = 30
				add_treasury = 250
				set_capital = 382
				define_ruler = {
					dynasty = "Ayyubid"
					ADM = 3
					DIP = 4
					MIL = 4
				}
				define_ruler_to_general = {
					fire = 4
					shock = 4
					manuever = 2
					siege = 3
				}
			}
			RYB = {
				capital_scope = {
					if = {
						limit = {
							religion = sunni
						}
						build_to_forcelimit = {
							infantry = 0.8
							cavalry = 0.2
						}
					}
					else = {
						build_to_forcelimit = {
							infantry = 0.4
							cavalry = 0.1
						}
					}
				}
				if = {
					limit = {
						num_of_owned_provinces_with = {
							value = 7
							OR = {
								area = syria_area
								area = aleppo_area
								area = syrian_desert_area
							}
							religion = sunni
						}
					}
					random_owned_province = {
						for = {
							amount = 20
							effect = "
								infantry = RYB
							"
						}
					}
					add_manpower = 20	
				}
				else = {
					random_owned_province = {
						for = {
							amount = 10
							effect = "
								infantry = RYB
							"
						}
					}
					add_manpower = 10
				}
				random_owned_province = {
					limit = {
						has_port = yes
					}
					build_to_forcelimit = {
						galley = 0.7
						light_ship = 0.2
						transport = 0.1
					}
				}
			}
		}		
	}

	option = {
		name = ab_byzantium_disaster.21.a
		ai_chance = { factor = 95 }
		set_country_flag = byz_timelimit_ayyubids
		declare_war_with_cb = {
			who = RYB
			casus_belli = cb_suppress_revolt
		}
		custom_tooltip = BYZ_WAR_AYYUBIDS
	}

	option = {
		name = ab_byzantium_disaster.21.b
		ai_chance = { factor = 5 }
		set_country_flag = byz_crisis_ayyubids
		add_truce_with = RYB
		custom_tooltip = BYZ_SURRENDER_AYYUBIDS
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = palestine_area
						area = trans_jordan_area
						region = egypt_region
					}
				}
				cede_province = RYB
				add_core = RYB
			}
			every_province = {
				limit = {
					owned_by = RYB
					is_core = BYZ
				}
				remove_core = BYZ
			}
		}
		if = {
			limit = {
				NOT = { exists = HSN }
			}
			RYB = {
				change_tag = HSN
				override_country_name = AYUB
				swap_non_generic_missions = yes
			}
		}
		else = {
			HSN = { 
				inherit = RYB 
				override_country_name = AYUB
			}
		}
	}
}

#Palestine join Ayyubids
country_event = {
	id = ab_byzantium_disaster.22
	title = ab_byzantium_disaster.22.t
	desc = ab_byzantium_disaster.22.d
	picture = ABAD7_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
		is_in_war = {
			attacker_leader = ROOT
			defender_leader = RYB
			casus_belli = cb_suppress_revolt
		}
		any_owned_province = {
			OR = {
				area = palestine_area
				area = trans_jordan_area
			}
		}
	}

	mean_time_to_happen = {
		months = 3
	}

	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = palestine_area
						area = trans_jordan_area
					}
				}
				cede_province = RYB
				add_core = RYB
			}
			RYB = {
				create_general = { tradition = 50 }
				add_treasury = 100
			}
			RYB = {
				if = {
					limit = {
						num_of_owned_provinces_with = {
							value = 3
							OR = {
								area = palestine_area
								area = trans_jordan_area
							}
							religion = sunni
						}
					}
					random_owned_province = {
						limit = {
							OR = {
								area = palestine_area
								area = trans_jordan_area
							}
						}
						for = {
							amount = 20
							effect = "
								infantry = RYB
							"
						}
					}
					add_manpower = 20	
				}
				else = {
					random_owned_province = {
						limit = {
							OR = {
								area = palestine_area
								area = trans_jordan_area
							}
						}
						for = {
							amount = 10
							effect = "
								infantry = RYB
							"
						}
					}
					add_manpower = 10
				}
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.22.a
	}
}

#Egypt join Ayyubids 1
country_event = {
	id = ab_byzantium_disaster.23
	title = ab_byzantium_disaster.23.t
	desc = ab_byzantium_disaster.23.d
	picture = ABAD7_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
		is_in_war = {
			attacker_leader = ROOT
			defender_leader = RYB
			casus_belli = cb_suppress_revolt
		}
		any_owned_province = {
			OR = {
				area = delta_area
				area = bahari_area
			}
		}
	}

	mean_time_to_happen = {
		months = 6
	}

	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = delta_area
						area = bahari_area
					}
				}
				cede_province = RYB
				add_core = RYB
			}
			RYB = {
				create_general = { tradition = 50 }
				add_treasury = 100
			}
			RYB = {
				if = {
					limit = {
						num_of_owned_provinces_with = {
							value = 4
							OR = {
								area = delta_area
								area = bahari_area
							}
							religion = sunni
						}
					}
					random_owned_province = {
						limit = {
							OR = {
								area = delta_area
								area = bahari_area
							}
						}
						for = {
							amount = 20
							effect = "
								infantry = RYB
							"
						}
					}
					add_manpower = 20	
				}
				else = {
					random_owned_province = {
						limit = {
							OR = {
								area = delta_area
								area = bahari_area
							}
						}
						for = {
							amount = 10
							effect = "
								infantry = RYB
							"
						}
					}
					add_manpower = 10
				}
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.23.a
		set_country_flag = byz_egypt_revolt
	}
}

#Egypt join Ayyubids 2
country_event = {
	id = ab_byzantium_disaster.24
	title = ab_byzantium_disaster.24.t
	desc = ab_byzantium_disaster.24.d
	picture = ABAD7_eventPicture
	
	fire_only_once = yes

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
		is_in_war = {
			attacker_leader = ROOT
			defender_leader = RYB
			casus_belli = cb_suppress_revolt
		}
		has_country_flag = byz_egypt_revolt
		any_owned_province = {
			region = egypt_region
		}
	}

	mean_time_to_happen = {
		months = 6
	}

	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					region = egypt_region
				}
				cede_province = RYB
				add_core = RYB
			}
			RYB = {
				create_general = { tradition = 50 }
				add_treasury = 100
			}
			RYB = {
				if = {
					limit = {
						num_of_owned_provinces_with = {
							value = 10
							region = egypt_region
							religion = sunni
						}
					}
					random_owned_province = {
						limit = {
							region = egypt_region
						}
						for = {
							amount = 20
							effect = "
								infantry = RYB
							"
						}
					}
					add_manpower = 20	
				}
				else = {
					random_owned_province = {
						limit = {
							region = egypt_region
						}
						for = {
							amount = 10
							effect = "
								infantry = RYB
							"
						}
					}
					add_manpower = 10
				}
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.24.a
	}
}

#Defeat the Ayyubids
country_event = {
	id = ab_byzantium_disaster.25
	title = ab_byzantium_disaster.25.t
	desc = ab_byzantium_disaster.25.d
	picture = PHEONIX_ASCENDANT_eventPicture

	is_triggered_only = yes 

	option = {
		name = ab_byzantium_disaster.25.a
		custom_tooltip = BYZ_PACIFIED_LEVANT
		hidden_effect = {
			every_owned_province = {
				limit = {
					is_core = RYB
				}
				add_province_modifier = {
					name = byz_pacified_levant
					duration = 3650
				}
				remove_core = RYB
			}
		}
		set_country_flag = byz_crisis_ayyubids
		clr_country_flag = byz_timelimit_ayyubids
	}
}

#Italians demand Italy - Leader choice
country_event = {
	id = ab_byzantium_disaster.26
	title = ab_byzantium_disaster.26.t
	desc = ab_byzantium_disaster.26.d
	picture = LIBERUM_VETO_eventPicture

	trigger = {
		OR = {
			AND = {
				tag = LOM
				NOT = { has_country_flag = byz_refused_italian_leader }
				is_part_of_hre = yes
			}
			AND = {
				OR = {
					NOT = { exists = LOM }
					LOM = { 
						OR = {
							has_country_flag = byz_refused_italian_leader 
							is_part_of_hre = no
						}
					}
				}
				culture_group = latin
				is_part_of_hre = yes
				NOT = { has_country_flag = byz_refused_italian_leader }
				NOT = { tag = PAP }
			}
		}
		BYZ = {
			has_disaster = byzantium_16th_crisis
			OR = {
				is_in_war = {
					attacker_leader = THIS
					defender_leader = RYB
					casus_belli = cb_suppress_revolt
				}
				has_country_flag = byz_crisis_ayyubids
			}
		}
		NOT = { has_global_flag = byz_picked_italian_leader }
	}

	mean_time_to_happen = {
		months = 6
		modifier = {
			factor = 0.1
			has_country_flag = byz_italian_league_candidate
		}
	}

	option = {
		name = ab_byzantium_disaster.26.a
		ai_chance = { factor = 50 }
		BYZ = { country_event = { id = ab_byzantium_disaster.27 } }
		set_global_flag = byz_picked_italian_leader
		clr_country_flag = byz_italian_league_candidate
		hidden_effect = {
			save_global_event_target_as = ItalianLeagueLeader
		}
	}

	option = {
		name = ab_byzantium_disaster.26.b
		ai_chance = { factor = 50 }
		trigger = {
			any_country = {
				culture_group = latin
				is_part_of_hre = yes
				NOT = { has_country_flag = byz_refused_italian_leader }
				NOT = { tag = ROOT }
				NOT = { tag = PAP }
			}
		}
		hidden_effect = {
			random_country = {
				limit = {
					culture_group = latin
					is_part_of_hre = yes
					NOT = { has_country_flag = byz_refused_italian_leader }
					NOT = { tag = ROOT }
					NOT = { tag = PAP }
				}
				set_country_flag = byz_italian_league_candidate
			}
		}
		set_country_flag = byz_refused_italian_leader
		clr_country_flag = byz_italian_league_candidate
	}
}

#Italians demand Italy - Byzantium response
country_event = {
	id = ab_byzantium_disaster.27
	title = ab_byzantium_disaster.27.t
	desc = ab_byzantium_disaster.27.d
	picture = BATTLE_eventPicture
	
	is_triggered_only = yes

	option = {
		name = ab_byzantium_disaster.27.a
		ai_chance = { factor = 90 }
		set_country_flag = byz_timelimit_italians
		event_target:ItalianLeagueLeader = {
			add_claim = 118
			declare_war_with_cb = {
			    who = BYZ
			    casus_belli = cb_italian_league_to_byz
				war_goal_province = 118
		    }
		}
		custom_tooltip = BYZ_WAR_ITALIANS
		hidden_effect = {
			swap_non_generic_missions = yes
			every_country = {
				limit = {
					culture_group = latin
					is_part_of_hre = yes
					NOT = { tag = event_target:ItalianLeagueLeader }
					NOT = { tag = PAP }
				}
				country_event = { id = ab_byzantium_disaster.28 }
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.27.b
		ai_chance = { factor = 10 }
		set_country_flag = byz_crisis_italians
		add_stability = -3
		custom_tooltip = BYZ_SURRENDER_ITALIANS
		hidden_effect = {
			every_owned_province = {
				limit = {
					region = italy_region
				}
				cede_province = event_target:ItalianLeagueLeader
				add_core = event_target:ItalianLeagueLeader
				set_in_empire = yes
			}
			clear_global_event_target = ItalianLeagueLeader
		}

	}
}

#Italian League - Join the war
country_event = {
	id = ab_byzantium_disaster.28
	title = ab_byzantium_disaster.28.t
	desc = ab_byzantium_disaster.28.d
	picture = BATTLE_eventPicture
	
	is_triggered_only = yes

	option = {
		name = ab_byzantium_disaster.28.a
		ai_chance = { factor = 80 }
		join_all_offensive_wars_of = event_target:ItalianLeagueLeader
	}

	option = {
		name = ab_byzantium_disaster.28.b
		ai_chance = { factor = 20 }
		add_prestige = -20
	}
}

#HRE Emperor intervene - HRE choice
country_event = {
	id = ab_byzantium_disaster.29
	title = ab_byzantium_disaster.29.t
	desc = ab_byzantium_disaster.29.d
	picture = BATTLE_eventPicture

	fire_only_once = yes

	trigger = {
		is_emperor = yes
		BYZ = {
			has_disaster = byzantium_16th_crisis
			is_in_war = {
				attacker_leader = event_target:ItalianLeagueLeader
				defender_leader = BYZ
				casus_belli = cb_italian_league_to_byz
			}
		}
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		name = ab_byzantium_disaster.29.a
		ai_chance = { factor = 90 }
		BYZ = { 
			country_event = { id = ab_byzantium_disaster.30 } 
		}
	}

	option = {
		name = ab_byzantium_disaster.29.b
		ai_chance = { factor = 10 }
		add_prestige = -20
	}
}

#HRE Emperor intervene - Byzantium response
country_event = {
	id = ab_byzantium_disaster.30
	title = ab_byzantium_disaster.30.t
	desc = ab_byzantium_disaster.30.d
	picture = BATTLE_eventPicture
	
	is_triggered_only = yes

	option = {
		name = ab_byzantium_disaster.30.a
		ai_chance = { factor = 90 }
		add_treasury = -1000
		add_prestige = -10
		emperor = {
			add_treasury = 1000
		}
	}

	option = {
		name = ab_byzantium_disaster.30.b
		ai_chance = { factor = 10 }
		emperor = {
			join_all_offensive_wars_of = event_target:ItalianLeagueLeader
		}
	}
}

#Defeat the Italians
country_event = {
	id = ab_byzantium_disaster.31
	title = ab_byzantium_disaster.31.t
	desc = ab_byzantium_disaster.31.d
	picture = PHEONIX_ASCENDANT_eventPicture
	
	is_triggered_only = yes 

	option = {
		name = ab_byzantium_disaster.31.a
		set_country_flag = byz_crisis_italians
		clr_country_flag = byz_timelimit_italians
		clear_global_event_target = ItalianLeagueLeader
		custom_tooltip = BYZ_CHEAPER_ITALY_CONQUEST
	}
}

#White peace with Italians
country_event = {
	id = ab_byzantium_disaster.32
	title = ab_byzantium_disaster.32.t
	desc = ab_byzantium_disaster.32.d
	picture = WOUNDED_SOLDIERS_eventPicture
	
	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
		is_in_war = {
			attacker_leader = event_target:ItalianLeagueLeader
			defender_leader = BYZ
			casus_belli = cb_italian_league_to_byz
		}
		had_country_flag = {
			flag = byz_timelimit_italians
			days = 3650
		}
	}

	option = {
		name = ab_byzantium_disaster.32.a
		hidden_effect = {
			white_peace = event_target:ItalianLeagueLeader
		}
		set_country_flag = byz_crisis_italians
		clr_country_flag = byz_timelimit_italians
		clear_global_event_target = ItalianLeagueLeader
	}
}

#Ayyubids win
country_event = {
	id = ab_byzantium_disaster.33
	title = ab_byzantium_disaster.33.t
	desc = ab_byzantium_disaster.33.d
	picture = WOUNDED_SOLDIERS_eventPicture
	
	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
		is_in_war = {
			attacker_leader = ROOT
			defender_leader = RYB
			casus_belli = cb_suppress_revolt
		}
		OR = {
			had_country_flag = {
				flag = byz_timelimit_ayyubids
				days = 3650
			}
			num_of_owned_provinces_with = {
				value = 10
				region = anatolia_region
				controlled_by = RYB
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.33.a
		hidden_effect = {
			white_peace = RYB
		}
		if = {
			limit = {
				NOT = { exists = HSN }
			}
			RYB = {
				change_tag = HSN
				override_country_name = AYUB
				swap_non_generic_missions = yes
			}
		}
		else = {
			HSN = { 
				inherit = RYB 
				override_country_name = AYUB
			}
		}
		hidden_effect = {
			HSN = {
				every_owned_province = {
					remove_core = BYZ
				}
			}
		}
		set_country_flag = byz_crisis_ayyubids
		clr_country_flag = byz_timelimit_ayyubids
	}
}

#Italians win
country_event = {
	id = ab_byzantium_disaster.34
	title = ab_byzantium_disaster.34.t
	desc = ab_byzantium_disaster.34.d
	picture = WOUNDED_SOLDIERS_eventPicture
	
	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
		is_in_war = {
			attacker_leader = event_target:ItalianLeagueLeader
			defender_leader = BYZ
			casus_belli = cb_italian_league_to_byz
		}
		OR = {
			AND = {
				has_country_flag = byz_occupied_roma
				had_country_flag = {
					flag = byz_occupied_roma
					days = 730
				}
			}
			NOT = {
				num_of_owned_provinces_with = {
					value = 1
					region = italy_region
					controlled_by = BYZ
				}
			}
		}
	}

	option = {
		name = ab_byzantium_disaster.34.a
		hidden_effect = {
			white_peace = event_target:ItalianLeagueLeader
			every_owned_province = {
				limit = {
					region = italy_region
				}
				cede_province = event_target:ItalianLeagueLeader
				add_core = event_target:ItalianLeagueLeader
				set_in_empire = yes
			}
			every_province = {
				limit = {
					region = italy_region
					is_core = BYZ
				}
				remove_core = BYZ
			}
		}
		set_country_flag = byz_crisis_italians
		clr_country_flag = byz_timelimit_italians
		clear_global_event_target = ItalianLeagueLeader
	}
}

#Rome sieged
country_event = {
	id = ab_byzantium_disaster.35
	title = ab_byzantium_disaster.35.t
	desc = ab_byzantium_disaster.35.d
	picture = ABAD5_eventPicture

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
		is_in_war = {
			attacker_leader = event_target:ItalianLeagueLeader
			defender_leader = BYZ
			casus_belli = cb_italian_league_to_byz
		}
		NOT = { has_country_flag = byz_occupied_roma }
		118 = {
			NOT = { controlled_by = BYZ } 
		}
	}

	option = {
		name = ab_byzantium_disaster.35.a
		set_country_flag = byz_occupied_roma
	}
}

#Rome sieged 2
country_event = {
	id = ab_byzantium_disaster.36
	title = ab_byzantium_disaster.36.t
	desc = ab_byzantium_disaster.36.d
	picture = ABAD5_eventPicture

	trigger = {
		tag = BYZ
		has_disaster = byzantium_16th_crisis
		is_in_war = {
			attacker_leader = event_target:ItalianLeagueLeader
			defender_leader = BYZ
			casus_belli = cb_italian_league_to_byz
		}
		has_country_flag = byz_occupied_roma
		118 = {
			controlled_by = BYZ
		}
	}

	option = {
		name = ab_byzantium_disaster.36.a
		clr_country_flag = byz_occupied_roma
	}
}