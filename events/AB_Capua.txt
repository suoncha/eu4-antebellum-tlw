### AB Events ###
namespace = ab_capua

#Mad Duke
country_event = {
	id = ab_capua.1
	title = ab_capua.1.t
	desc = ab_capua.1.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_capua.1.a
		add_ruler_modifier = {
			name = "cap_rex_romanorum"
			duration = -1
		}
	}
}

#Mad King of Rome
country_event = {
	id = ab_capua.2
	title = ab_capua.2.t
	desc = ab_capua.2.d
	picture = ST_PETERS_CHURCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_capua.2.a
		add_prestige = 20
		add_legitimacy = 20
		hidden_effect = {
			country_event = {
				id = ab_capua.4
				days = 180
			}
		}
	}
}

#Lords of Rome
country_event = {
	id = ab_capua.3
	title = ab_capua.3.t
	desc = ab_capua.3.d
	picture = ST_PETERS_CHURCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_capua.3.a
		add_prestige = 15
		add_legitimacy = 15
	}
}

#Crimson King
country_event = {
	id = ab_capua.4
	title = ab_capua.4.t
	desc = ab_capua.4.d
	picture = ST_PETERS_CHURCH_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_ruler = "Robert XI"
	}
	
	option = {
		name = ab_capua.4.a
		add_ruler_modifier = {
			name = "cap_crimson_king"
			duration = -1
		}
		hidden_effect = {
			country_event = {
				id = ab_capua.5
				days = 300
			}
		}
	}
}

#Crimson King
country_event = {
	id = ab_capua.5
	title = ab_capua.5.t
	desc = ab_capua.5.d
	picture = ST_PETERS_CHURCH_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_ruler = "Robert XI"
	}
	
	option = {
		name = ab_capua.5.a
		add_country_modifier = {
			name = "cap_reborn"
			duration = 7300
		}
	}
}

#Ship
country_event = {
	id = ab_capua.6
	title = ab_capua.6.t
	desc = ab_capua.6.d
	picture = SHIP_SAILING_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_capua.6.a
		add_navy_tradition = 10
	}
}

#Gaston
country_event = {
	id = ab_capua.7
	title = ab_capua.7.t
	desc = ab_capua.7.d
	picture = ADVISOR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_capua.7.a
		define_general = {
			name = "Gaston de Hauteville"
			fire = 4
			shock = 5
			manuever = 3
			siege = 2
		}
	}
	
	option = {
		name = ab_capua.7.b
		define_admiral = {
			name = "Gaston de Hauteville"
			fire = 5
			shock = 5
			manuever = 3
		}
	}
	
	option = {
		name = ab_capua.7.c
		define_heir = {
			claim = 100
			dynasty = ROOT
			name = "Gaston"
			age = 20
			adm = 5
			dip = 5
			mil = 5
		}
	}
}

#Opera
country_event = {
	id = ab_capua.8
	title = ab_capua.8.t
	desc = ab_capua.8.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_capua.8.a
		add_country_modifier = {
			name = "cap_opera"
			duration = -1
		}
		hidden_effect = {
			country_event = {
				id = ab_capua.9
				days = 1500
			}
		}
	}
}

#Turan
country_event = {
	id = ab_capua.9
	title = ab_capua.9.t
	desc = ab_capua.9.d
	picture = ADVISOR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_capua.9.a
		add_prestige = 15
	}
}

country_event = {
	id = ab_capua.10
	title = ab_capua.10.t
	desc = ab_capua.10.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes

	trigger = {
		has_ruler = "Robert XI"
	}
	
	option = {
		name = ab_capua.10.a
		add_legitimacy = -5
		hidden_effect = {
			country_event = {
				id = ab_capua.11
				days = 730
				random = 90
			}
		}
	}
}

country_event = {
	id = ab_capua.11
	title = ab_capua.11.t
	desc = ab_capua.11.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_ruler = "Robert XI"
	}
	
	option = {
		name = ab_capua.11.a
		add_legitimacy = -5
		hidden_effect = {
			country_event = {
				id = ab_capua.12
				days = 1460
				random = 90
			}
		}
	}
}

country_event = {
	id = ab_capua.12
	title = ab_capua.12.t
	desc = ab_capua.12.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes

	trigger = {
		has_ruler = "Robert XI"
	}
	
	option = {
		name = ab_capua.12.a
		add_legitimacy = -5
		hidden_effect = {
			country_event = {
				id = ab_capua.13
				days = 365
				random = 90
			}
		}
	}
}

country_event = {
	id = ab_capua.13
	title = ab_capua.13.t
	desc = ab_capua.13.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_ruler = "Robert XI"
	}
	
	option = {
		name = ab_capua.13.a
		add_legitimacy = -10
		hidden_effect = {
			country_event = {
				id = ab_capua.14
				days = 30
				random = 60
			}
		}
	}
}

country_event = {
	id = ab_capua.14
	title = ab_capua.14.t
	desc = ab_capua.14.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_ruler = "Robert XI"
	}
	
	option = {
		name = ab_capua.14.a
		hidden_effect = {
			remove_ruler_personality = sinner_personality
		}
		add_ruler_personality = immortal_personality
		hidden_effect = {
			country_event = {
				id = ab_capua.15
				days = 1095
			}
		}
	}
}

country_event = {
	id = ab_capua.15
	title = ab_capua.15.t
	desc = ab_capua.15.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_ruler = "Robert XI"
		NOT = { mission_completed = trc_the_mad_dukes_gambit }
	}

	immediate = {
		hidden_effect = {
			kill_ruler = yes
		}
	}
	
	option = {
		name = ab_capua.15.a
	}
}

country_event = {
	id = ab_capua.16
	title = ab_capua.16.t
	desc = ab_capua.16.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	major = yes
	
	option = {
		name = ab_capua.16.a
		custom_tooltip = TRC_TRINACRIAN_CULTURE
		change_monarch_points_or_power = {
			points = 2
			power = mil
		}
		add_country_modifier = {
			name = trc_reborn
			duration = -1
		}
		hidden_effect = {
			every_owned_province = {
				limit = {
					culture = sicilian
				}
				change_culture = trinacrian
			}
		}
	}
}

#Timed Mission Unlock
country_event = {
	id = ab_capua.17
	title = ab_capua.17.t
	desc = ab_capua.17.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ab_lombardy.1.a
		set_country_flag = trc_mission_unlocked
		hidden_effect = {
			swap_non_generic_missions = yes
		}
	}
}

#Timed Mission Fail
country_event = {
	id = ab_capua.18
	title = ab_capua.18.t
	desc = ab_capua.18.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		has_country_flag = trc_mission_unlocked
		NOT = { mission_completed = trc_the_mad_dukes_gambit }
		NOT = { has_ruler = "Robert XI" }
	}
	
	immediate = {
		hidden_effect = {
			clr_country_flag = trc_mission_unlocked
			set_country_flag = trc_mission_failed
			swap_non_generic_missions = yes
		}
	}
	
	option = {
		name = ab_capua.18.a
	}
}

### TLW Events ###
namespace = ab_capua

# Visitors from the East
country_event = {
	id = tlw_capua.0
	title = tlw_capua.0.t
	desc = tlw_capua.0.d
	picture = MYSTIC_IN_PRAYER_eventPicture

	is_triggered_only = yes

	option = {
		name = tlw_capua.0.a
		trigger = {
			NOT = { has_country_flag = ab_stronger_ai_cap }
		}
		add_prestige = 10
	}

	option = {
		name = tlw_capua.0.b
		trigger = {
			OR = {
				ai = no
				has_country_flag = ab_stronger_ai_cap
			}
		}
		highlight = yes
		set_country_flag = cap_chose_sol_invictus_flag
		set_ruler_religion = sol_invictus
		custom_tooltip = AB_EMPTY
		custom_tooltip = CAP_UNLOCK_SOL_EVENTS
		hidden_effect = {
			country_event = {
				id = tlw_capua.1
				days = 30
			}
		}
	}
}

# Reform Our Court
country_event = {
	id = tlw_capua.1
	title = tlw_capua.1.t
	desc = tlw_capua.1.d
	picture = COURT_eventPicture

	is_triggered_only = yes

	option = {
		name = tlw_capua.1.a
		define_advisor = {
			type = inquisitor
			skill = 3
			religion = sol_invictus
			cost_multiplier = 0.1
		}
		custom_tooltip = AB_EMPTY
		define_advisor = {
			type = ae_advisor
			skill = 3
			religion = sol_invictus
			cost_multiplier = 0.1
		}
		custom_tooltip = AB_EMPTY
		define_advisor = {
			type = siegeengineer
			skill = 3
			religion = sol_invictus
			cost_multiplier = 0.1
		}
		hidden_effect = {
			country_event = {
				id = tlw_capua.2
				days = 30
			}
		}
	}
}

# Restore the Roman Bureaucracy
country_event = {
	id = tlw_capua.2
	title = tlw_capua.2.t
	desc = tlw_capua.2.d
	picture = CITY_VIEW_eventPicture

	is_triggered_only = yes

	option = {
		name = tlw_capua.2.a
		custom_tooltip = CAP_WILL_FIGHT_POPE
		custom_tooltip = AB_EMPTY
		unlock_government_reform = {
			government_reform = capua_roman_bureaucracy
		}
		custom_tooltip = AB_EMPTY
		add_government_reform = capua_roman_bureaucracy
		hidden_effect = {
			country_event = {
				id = tlw_capua.3
				days = 30
			}
		}
	}
}

# A Sol Invictus Kingdom
country_event = {
	id = tlw_capua.3
	title = tlw_capua.3.t
	desc = tlw_capua.3.d
	picture = BYZ_BATTLE_eventPicture

	major = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_heir_religion = sol_invictus
			set_consort_religion = sol_invictus
			add_treasury = 500
			capital_scope = {
				for = {
					amount = 20
					effect = "
						infantry = ROOT
					"
				}
			}
			lazio_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT	}
					NOT = { is_core = ROOT	}
				}
				add_core = ROOT
			}
			central_italy_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT	}
					NOT = { is_core = ROOT	}
				}
				add_core = ROOT
			}
			declare_war_with_cb = {
				casus_belli = cb_core
				who = PAP
				war_goal_province = 118
			}
			set_government_rank = 2
			if = {
				limit = {
					has_country_flag = ab_stronger_ai_cap
					ai = yes
				}	
				add_treasury = 500
				add_manpower = 100
				create_general = { tradition = 100 }
				add_ruler_personality = augustus_personality
				add_stability = 2
				capital_scope = {
					for = {
						amount = 20
						effect = "
							infantry = ROOT
						"
					}
				}
				PAP = {
					if = {
						limit = {
							ai = yes
						}
						add_stability = -3
						add_treasury = -200
						add_manpower = -20
					}
				}
				4732 = {
					change_controller = ROOT
				}
				118 = {
					change_controller = ROOT
				}
			}
		}
	}

	option = {
		name = tlw_capua.3.a
		enable_religion = sol_invictus
		change_religion = sol_invictus
		tooltip = {
			set_government_rank = 2
			add_treasury = 500
			custom_tooltip = AB_EMPTY
			lazio_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT	}
					NOT = { is_core = ROOT	}
				}
				add_core = ROOT
			}
			central_italy_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT	}
					NOT = { is_core = ROOT	}
				}
				add_core = ROOT
			}
		}
	}
}

# Dream of Rome
country_event = {
	id = tlw_capua.4
	title = tlw_capua.4.t
	desc = tlw_capua.4.d
	picture = BYZ_BYZANTINE_EAGLE_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_country_flag = ab_is_rome_heir
			set_country_flag = cap_embraced_sol_invictus
			swap_non_generic_missions = yes
		}
	}

	option = {
		name = tlw_capua.4.a
		118 = {
			move_capital_effect = yes
			custom_tooltip = AB_EMPTY
			change_religion = sol_invictus
		}
		custom_tooltip = CAP_SPAWN_CENTER_ROME
		hidden_effect = {
			118 = {
				add_reform_center = sol_invictus
			}
		}
		custom_tooltip = AB_EMPTY
		custom_tooltip = CAP_UNLOCK_ITALY_CB
	}
}

# The Mad Emperor
country_event = {
	id = tlw_capua.5
	title = tlw_capua.5.t
	desc = tlw_capua.5.d
	picture = BYZ_BYZANTINE_EMPEROR_eventPicture

	major = yes

	is_triggered_only = yes

	option = {
		name = tlw_capua.5.a
		add_ruler_personality = augustus_personality
		custom_tooltip = BYZ_ALWAYS_AUGUSTUS
		custom_tooltip = AB_EMPTY
		# TLW [[[
		TLW_switch_flag_triumvirate_effect = yes
		# ]]]
		change_tag = ROM
		on_change_tag_effect = yes
		# TLW [[[
		TLW_switch_target_triumvirate_effect = yes
		# ]]]
		custom_tooltip = AB_EMPTY
		change_primary_culture = roman_new
		custom_tooltip = AB_EMPTY
		custom_tooltip = CAP_FASTER_ROMANIZATION
		custom_tooltip = AB_EMPTY
		custom_tooltip = CAP_ROMANIZATION_ON_EVENT
		custom_tooltip = AB_EMPTY
		custom_tooltip = restore_roman_empire_tt
		hidden_effect = {
			every_owned_province = {
				limit = {
					is_part_of_hre = yes
				}
				set_in_empire = no
			}
		}
		hidden_effect = {
			set_heir_culture = ROOT
			set_ruler_culture = ROOT
			118 = {
				add_core = ROOT
				province_event = {
					id = tlw_rome.0
				}
			}
			country_event = {
				id = tlw_rome.1
			}
		}
		custom_tooltip = AB_EMPTY
		if = {
			limit = {
				has_custom_ideas = no
			}
			country_event = {
				id = ideagroups.1
			}
		}
		add_country_modifier = {
			name = centralization_modifier
			duration = 7300
		}
		swap_non_generic_missions = yes
		if = {
			limit = {
				NOT = { has_global_flag = NO_CNS }
				any_subject_country = {
					is_colonial_nation = yes
				}
			}
			custom_tooltip = AB_EMPTY
			custom_tooltip = AB_TURN_CNS_INTO_PRESET_CNS
			hidden_effect = {
				every_subject_country = {
					limit = {
						is_colonial_nation = yes
					}
					ab_swap_to_preset_cn_tag = { tag = rome }
				}
			}
		}
	}
}

# Death of the Emperor
country_event = {
	id = tlw_capua.6
	title = tlw_capua.6.t
	desc = tlw_capua.6.d
	picture = DEATH_OF_HEIR_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_country_flag = cap_robert_is_dead
			if = {
				limit = {
					NOT = { exists = IVR }
				}
				every_owned_province = {
					limit = {
						OR = {
							area = piedmont_area
							area = liguria_area
						}
					}
					add_core = IVR
				}
				release = IVR
				IVR = {
					change_religion = sol_invictus
				}
				declare_war_with_cb = {
					casus_belli = cb_capua_roman_reconquest
					who = IVR
				}
			}
			if = {
				limit = {
					NOT = { exists = LOM }
				}
				every_owned_province = {
					limit = {
						OR = {
							area = lombardy_area
							area = po_valley_area
						}
					}
					add_core = LOM
				}
				release = LOM
				LOM = {
					change_religion = sol_invictus
				}
				declare_war_with_cb = {
					casus_belli = cb_capua_roman_reconquest
					who = LOM
				}
			}
			if = {
				limit = {
					NOT = { exists = RMG }
				}
				every_owned_province = {
					limit = {
						area = emilia_romagna_area
					}
					add_core = RMG
				}
				release = RMG
				RMG = {
					change_religion = sol_invictus
				}
				declare_war_with_cb = {
					casus_belli = cb_capua_roman_reconquest
					who = RMG
				}
			}
			if = {
				limit = {
					NOT = { exists = LAN }
				}
				every_owned_province = {
					limit = {
						area = tuscany_area
					}
					add_core = LAN
				}
				release = LAN
				LAN = {
					change_religion = sol_invictus
				}
				declare_war_with_cb = {
					casus_belli = cb_capua_roman_reconquest
					who = LAN
				}
			}
			if = {
				limit = {
					NOT = { exists = VRN }
				}
				every_owned_province = {
					limit = {
						area = venetia_area
					}
					add_core = VRN
				}
				release = VRN
				VRN = {
					change_religion = sol_invictus
				}
				declare_war_with_cb = {
					casus_belli = cb_capua_roman_reconquest
					who = VRN
				}
			}
		}
	}

	option = {
		name = tlw_capua.6.a
		custom_tooltip = CAP_UNLOCK_ROBERT_ICON
	}
}

# The Key to Immortality
country_event = {
	id = tlw_capua.7
	title = tlw_capua.7.t
	desc = tlw_capua.7.d
	picture = MYSTIC_IN_PRAYER_eventPicture

	is_triggered_only = yes

	trigger = {
		religion = sol_invictus
		has_ruler = "Robert XI"
	}

	option = {
		name = tlw_capua.7.a
		add_ruler_modifier = {
			name = cap_prolong_life
			duration = -1
		}
	}
}

# To Pay the Price 1
country_event = {
	id = tlw_capua.8
	title = tlw_capua.8.t
	desc = tlw_capua.8.d
	picture = MYSTIC_IN_PRAYER_eventPicture

	fire_only_once = yes

	trigger = {
		has_ruler_modifier = cap_prolong_life
		is_year = 1500
	}

	option = {
		name = tlw_capua.8.a
		ai_chance = { factor = 0 }
		grant_all_mana = {
			mana = -50
		}
		add_treasury = -200
		add_legitimacy = -10
		custom_tooltip = AB_EMPTY
		custom_tooltip = CAP_EXTEND_ROBERT_LIFESPAN
		hidden_effect = {
			country_event = {
				id = tlw_capua.9
				days = 1825
			}
		}
	}

	option = {
		name = tlw_capua.8.b
		ai_chance = { factor = 100 }
		kill_ruler = yes
	}
}

# To Pay the Price 2
country_event = {
	id = tlw_capua.9
	title = tlw_capua.9.t
	desc = tlw_capua.9.d
	picture = MYSTIC_IN_PRAYER_eventPicture

	is_triggered_only = yes

	trigger = {
		has_ruler_modifier = cap_prolong_life
	}

	option = {
		name = tlw_capua.9.a
		grant_all_mana = {
			mana = -100
		}
		add_treasury = -400
		add_legitimacy = -20
		custom_tooltip = AB_EMPTY
		custom_tooltip = CAP_EXTEND_ROBERT_LIFESPAN
		hidden_effect = {
			country_event = {
				id = tlw_capua.10
				days = 1825
			}
		}
	}

	option = {
		name = tlw_capua.9.b
		kill_ruler = yes
	}
}

# To Pay the Price 3
country_event = {
	id = tlw_capua.10
	title = tlw_capua.10.t
	desc = tlw_capua.10.d
	picture = MYSTIC_IN_PRAYER_eventPicture

	is_triggered_only = yes

	trigger = {
		has_ruler_modifier = cap_prolong_life
	}

	option = {
		name = tlw_capua.10.a
		grant_all_mana = {
			mana = -200
		}
		add_treasury = -800
		add_legitimacy = -40
		custom_tooltip = AB_EMPTY
		custom_tooltip = CAP_EXTEND_ROBERT_LIFESPAN
		hidden_effect = {
			country_event = {
				id = tlw_capua.11
				days = 1825
			}
		}
	}

	option = {
		name = tlw_capua.10.b
		kill_ruler = yes
	}
}

# To Pay the Price 4
country_event = {
	id = tlw_capua.11
	title = tlw_capua.11.t
	desc = tlw_capua.11.d
	picture = MYSTIC_IN_PRAYER_eventPicture

	is_triggered_only = yes

	trigger = {
		has_ruler_modifier = cap_prolong_life
	}

	option = {
		name = tlw_capua.11.a
		grant_all_mana = {
			mana = -400
		}
		add_treasury = -1600
		add_legitimacy = -80
		custom_tooltip = AB_EMPTY
		custom_tooltip = CAP_EXTEND_ROBERT_LIFESPAN
		hidden_effect = {
			country_event = {
				id = tlw_capua.11
				days = 1825
			}
		}
	}

	option = {
		name = tlw_capua.11.b
		kill_ruler = yes
	}
}